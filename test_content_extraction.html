<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†…å®¹æå–æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .header {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .nav {
            background: #e9ecef;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .main-content {
            background: white;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .sidebar {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            float: right;
            width: 200px;
            margin-left: 20px;
        }
        .footer {
            background: #343a40;
            color: white;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .highlight {
            background: #fff3cd;
            padding: 10px;
            border-left: 4px solid #ffc107;
            margin: 10px 0;
        }
        .content-area {
            background: #f0f9ff;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .test-button {
            background: #3370ff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .test-button:hover {
            background: #2860e1;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>å†…å®¹æå–åŠŸèƒ½æµ‹è¯•é¡µé¢</h1>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•æ’ä»¶çš„å†…å®¹æå–åŠŸèƒ½ï¼Œç¡®ä¿èƒ½å¤Ÿå…¨é€‰é¡µé¢æ‰€æœ‰ç›¸å…³å†…å®¹ã€‚</p>
    </div>
    
    <div class="nav">
        <a href="#">é¦–é¡µ</a> | 
        <a href="#">å…³äº</a> | 
        <a href="#">è”ç³»</a> | 
        <a href="#">å¸®åŠ©</a>
    </div>
    
    <div class="sidebar">
        <h3>ä¾§è¾¹æ </h3>
        <p>è¿™æ˜¯ä¾§è¾¹æ å†…å®¹ï¼Œåº”è¯¥è¢«è¿‡æ»¤æ‰ã€‚</p>
        <ul>
            <li>ç›¸å…³é“¾æ¥1</li>
            <li>ç›¸å…³é“¾æ¥2</li>
            <li>ç›¸å…³é“¾æ¥3</li>
        </ul>
    </div>
    
    <div class="main-content">
        <h2>ä¸»è¦æ–‡ç« å†…å®¹</h2>
        
        <div class="content-area">
            <h3>äººå·¥æ™ºèƒ½åœ¨åŒ»ç–—é¢†åŸŸçš„åº”ç”¨å‰æ™¯</h3>
            <p>éšç€æŠ€æœ¯çš„å¿«é€Ÿå‘å±•ï¼Œäººå·¥æ™ºèƒ½åœ¨åŒ»ç–—é¢†åŸŸçš„åº”ç”¨è¶Šæ¥è¶Šå¹¿æ³›ã€‚ä»è¯Šæ–­è¾…åŠ©åˆ°è¯ç‰©ç ”å‘ï¼ŒAIæŠ€æœ¯æ­£åœ¨æ”¹å˜ä¼ ç»ŸåŒ»ç–—æ¨¡å¼ã€‚</p>
            
            <div class="highlight">
                <h4>æ ¸å¿ƒè¦ç‚¹</h4>
                <p>AIåœ¨åŒ»ç–—é¢†åŸŸçš„åº”ç”¨ä¸»è¦åŒ…æ‹¬ï¼šåŒ»å­¦å½±åƒè¯Šæ–­ã€ä¸ªæ€§åŒ–æ²»ç–—æ–¹æ¡ˆã€è¯ç‰©ç ”å‘åŠ é€Ÿã€åŒ»ç–—èµ„æºä¼˜åŒ–ç­‰ã€‚</p>
            </div>
            
            <h4>ä¸»è¦åº”ç”¨é¢†åŸŸ</h4>
            <p><strong>åŒ»å­¦å½±åƒè¯Šæ–­ï¼š</strong>AIåœ¨åŒ»å­¦å½±åƒåˆ†ææ–¹é¢è¡¨ç°å‡ºè‰²ï¼Œèƒ½å¤Ÿå¿«é€Ÿå‡†ç¡®åœ°è¯†åˆ«Xå…‰ç‰‡ã€CTæ‰«æå’ŒMRIå›¾åƒä¸­çš„å¼‚å¸¸ã€‚ç ”ç©¶è¡¨æ˜ï¼ŒAIåœ¨æŸäº›ç–¾ç—…çš„è¯Šæ–­å‡†ç¡®ç‡å·²ç»è¾¾åˆ°æˆ–è¶…è¿‡äººç±»ä¸“å®¶æ°´å¹³ã€‚</p>
            
            <p><strong>è¯ç‰©ç ”å‘ï¼š</strong>äººå·¥æ™ºèƒ½å¯ä»¥åŠ é€Ÿè¯ç‰©å‘ç°è¿‡ç¨‹ï¼Œé€šè¿‡åˆ†æå¤§é‡åˆ†å­æ•°æ®æ¥é¢„æµ‹æ–°è¯ç‰©çš„æœ‰æ•ˆæ€§å’Œå®‰å…¨æ€§ã€‚è¿™å¤§å¤§ç¼©çŸ­äº†è¯ç‰©ä»å®éªŒå®¤åˆ°å¸‚åœºçš„å¼€å‘å‘¨æœŸã€‚</p>
            
            <p><strong>ä¸ªæ€§åŒ–åŒ»ç–—ï¼š</strong>åŸºäºæ‚£è€…çš„åŸºå› ä¿¡æ¯ã€ç—…å²å’Œç”Ÿæ´»ä¹ æƒ¯ï¼ŒAIå¯ä»¥ä¸ºæ¯ä¸ªæ‚£è€…åˆ¶å®šä¸ªæ€§åŒ–çš„æ²»ç–—æ–¹æ¡ˆï¼Œæé«˜æ²»ç–—æ•ˆæœå¹¶å‡å°‘å‰¯ä½œç”¨ã€‚</p>
        </div>
        
        <div class="test-section">
            <h3>æŠ€æœ¯å®ç°ç»†èŠ‚</h3>
            <p>ç°ä»£AIåŒ»ç–—ç³»ç»Ÿé€šå¸¸é‡‡ç”¨æ·±åº¦å­¦ä¹ ç®—æ³•ï¼Œç»“åˆå¤§æ•°æ®åˆ†ææŠ€æœ¯ï¼Œèƒ½å¤Ÿå¤„ç†æµ·é‡çš„åŒ»ç–—æ•°æ®ã€‚è¿™äº›ç³»ç»Ÿä¸ä»…èƒ½å¤Ÿæä¾›è¯Šæ–­å»ºè®®ï¼Œè¿˜èƒ½å¤Ÿé¢„æµ‹ç–¾ç—…å‘å±•è¶‹åŠ¿ï¼Œä¸ºé¢„é˜²åŒ»å­¦æä¾›é‡è¦æ”¯æŒã€‚</p>
            
            <ul>
                <li>æœºå™¨å­¦ä¹ ç®—æ³•ä¼˜åŒ–</li>
                <li>å¤§æ•°æ®å¤„ç†èƒ½åŠ›</li>
                <li>å®æ—¶åˆ†æåŠŸèƒ½</li>
                <li>å¤šæ¨¡æ€æ•°æ®èåˆ</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h3>æŒ‘æˆ˜ä¸æœºé‡</h3>
            <p>å°½ç®¡AIåœ¨åŒ»ç–—é¢†åŸŸå±•ç°å‡ºå·¨å¤§æ½œåŠ›ï¼Œä½†ä»é¢ä¸´æ•°æ®éšç§ã€ç®—æ³•é€æ˜åº¦ã€ç›‘ç®¡åˆè§„ç­‰æŒ‘æˆ˜ã€‚åŒæ—¶ï¼Œè¿™ä¹Ÿä¸ºåŒ»ç–—è¡Œä¸šå¸¦æ¥äº†å‰æ‰€æœªæœ‰çš„å‘å±•æœºé‡ã€‚</p>
            
            <p>æœªæ¥ï¼Œéšç€æŠ€æœ¯çš„ä¸æ–­è¿›æ­¥å’Œæ”¿ç­–çš„å®Œå–„ï¼Œäººå·¥æ™ºèƒ½å°†åœ¨åŒ»ç–—é¢†åŸŸå‘æŒ¥æ›´åŠ é‡è¦çš„ä½œç”¨ï¼Œä¸ºäººç±»å¥åº·äº‹ä¸šåšå‡ºæ›´å¤§è´¡çŒ®ã€‚</p>
        </div>
    </div>
    
    <div class="footer">
        <p>Â© 2024 å†…å®¹æå–æµ‹è¯•é¡µé¢ - è¿™æ˜¯é¡µè„šå†…å®¹ï¼Œåº”è¯¥è¢«è¿‡æ»¤æ‰</p>
    </div>
    
    <div style="clear: both; margin-top: 30px;">
        <h3>æµ‹è¯•åŠŸèƒ½</h3>
        <button class="test-button" onclick="testContentExtraction()">æµ‹è¯•å†…å®¹æå–</button>
        <button class="test-button" onclick="showPageStructure()">æ˜¾ç¤ºé¡µé¢ç»“æ„</button>
        <button class="test-button" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        
        <div id="results" class="result" style="display: none;"></div>
    </div>

    <script>
        // æ¨¡æ‹Ÿå†…å®¹æå–åŠŸèƒ½
        function extractPageContent() {
            // è·å–é¡µé¢æ ‡é¢˜
            const title = document.title || '';
            
            // è·å–é¡µé¢URL
            const url = window.location.href;
            
            // æå–ä¸»è¦æ–‡æœ¬å†…å®¹
            let content = '';
            
            // æ‰©å±•çš„æ–‡ç« å†…å®¹é€‰æ‹©å™¨ï¼Œç¡®ä¿å…¨é€‰é¡µé¢æ‰€æœ‰å†…å®¹
            const articleSelectors = [
                'article',
                '[role="main"]',
                '.content',
                '.post-content',
                '.article-content',
                '.entry-content',
                '.post-body',
                '.article-body',
                '.main-content',
                '.page-content',
                '.story-content',
                '.text-content',
                '.body-content',
                '.content-area',
                '.content-wrapper',
                '.main',
                '.main-area',
                '.primary-content',
                '.primary',
                '.container',
                '.wrapper'
            ];
            
            let mainContent = null;
            
            // é¦–å…ˆå°è¯•æ‰¾åˆ°ç‰¹å®šçš„å†…å®¹åŒºåŸŸ
            for (const selector of articleSelectors) {
                const element = document.querySelector(selector);
                if (element) {
                    // æ£€æŸ¥å…ƒç´ æ˜¯å¦æœ‰è¶³å¤Ÿçš„æ–‡æœ¬å†…å®¹
                    const textContent = element.textContent.trim();
                    if (textContent.length > 100) { // ç¡®ä¿æœ‰è¶³å¤Ÿçš„å†…å®¹
                        mainContent = element;
                        console.log('æ‰¾åˆ°å†…å®¹åŒºåŸŸ:', selector);
                        break;
                    }
                }
            }
            
            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç‰¹å®šçš„å†…å®¹åŒºåŸŸï¼Œå°è¯•æ›´æ™ºèƒ½çš„é€‰æ‹©
            if (!mainContent) {
                // æŸ¥æ‰¾åŒ…å«æœ€å¤šæ–‡æœ¬çš„å…ƒç´ 
                const candidates = document.querySelectorAll('div, section, main, article');
                let bestCandidate = null;
                let maxTextLength = 0;
                
                candidates.forEach(element => {
                    const textContent = element.textContent.trim();
                    // æ’é™¤å¯¼èˆªã€é¡µè„šã€ä¾§è¾¹æ ç­‰
                    const className = element.className.toLowerCase();
                    const id = element.id.toLowerCase();
                    
                    if (!className.includes('nav') && 
                        !className.includes('footer') && 
                        !className.includes('sidebar') && 
                        !className.includes('header') &&
                        !id.includes('nav') && 
                        !id.includes('footer') && 
                        !id.includes('sidebar') && 
                        !id.includes('header') &&
                        textContent.length > maxTextLength &&
                        textContent.length > 200) { // è‡³å°‘200å­—ç¬¦
                        maxTextLength = textContent.length;
                        bestCandidate = element;
                    }
                });
                
                if (bestCandidate) {
                    mainContent = bestCandidate;
                    console.log('é€‰æ‹©æœ€ä½³å†…å®¹åŒºåŸŸ:', bestCandidate.tagName, bestCandidate.className);
                }
            }
            
            // å¦‚æœè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„å†…å®¹åŒºåŸŸï¼Œä½¿ç”¨body
            if (!mainContent) {
                mainContent = document.body;
                console.log('ä½¿ç”¨bodyä½œä¸ºå†…å®¹åŒºåŸŸ');
            }
            
            // æå–æ–‡æœ¬å†…å®¹ï¼Œè¿‡æ»¤æ‰è„šæœ¬å’Œæ ·å¼
            const walker = document.createTreeWalker(
                mainContent,
                NodeFilter.SHOW_TEXT,
                {
                    acceptNode: function(node) {
                        // è·³è¿‡è„šæœ¬å’Œæ ·å¼æ ‡ç­¾ä¸­çš„æ–‡æœ¬
                        const parent = node.parentElement;
                        if (parent && (parent.tagName === 'SCRIPT' || parent.tagName === 'STYLE')) {
                            return NodeFilter.FILTER_REJECT;
                        }
                        
                        // è·³è¿‡å¯¼èˆªã€é¡µè„šã€ä¾§è¾¹æ ç­‰
                        if (parent) {
                            const className = parent.className.toLowerCase();
                            const id = parent.id.toLowerCase();
                            if (className.includes('nav') || 
                                className.includes('footer') || 
                                className.includes('sidebar') || 
                                className.includes('header') ||
                                id.includes('nav') || 
                                id.includes('footer') || 
                                id.includes('sidebar') || 
                                id.includes('header')) {
                                return NodeFilter.FILTER_REJECT;
                            }
                        }
                        
                        return NodeFilter.FILTER_ACCEPT;
                    }
                }
            );
            
            const textNodes = [];
            let node;
            while (node = walker.nextNode()) {
                const text = node.textContent.trim();
                if (text.length > 5) { // é™ä½æœ€å°é•¿åº¦è¦æ±‚ï¼Œç¡®ä¿è·å–æ›´å¤šå†…å®¹
                    textNodes.push(text);
                }
            }
            
            content = textNodes.join('\n\n');
            
            // å¦‚æœå†…å®¹å¤ªå°‘ï¼Œå°è¯•è·å–æ›´å¤šå†…å®¹
            if (content.length < 500) {
                console.log('å†…å®¹å¤ªå°‘ï¼Œå°è¯•è·å–æ›´å¤šå†…å®¹');
                // ç›´æ¥è·å–bodyçš„æ‰€æœ‰æ–‡æœ¬å†…å®¹
                const bodyText = document.body.textContent.trim();
                const lines = bodyText.split('\n').filter(line => line.trim().length > 10);
                content = lines.join('\n\n');
            }
            
            // æ¸…ç†å†…å®¹ï¼šç§»é™¤å¤šä½™çš„ç©ºç™½å­—ç¬¦
            content = content.replace(/\s+/g, ' ').trim();
            
            // é™åˆ¶å†…å®¹é•¿åº¦ï¼Œé¿å…APIè°ƒç”¨è¿‡å¤§
            if (content.length > 12000) { // å¢åŠ å†…å®¹é•¿åº¦é™åˆ¶
                content = content.substring(0, 12000) + '...';
                console.log('å†…å®¹å·²æˆªæ–­åˆ°12000å­—ç¬¦');
            }
            
            console.log('æå–çš„å†…å®¹é•¿åº¦:', content.length);
            console.log('å†…å®¹é¢„è§ˆ:', content.substring(0, 200) + '...');
            
            return {
                title,
                url,
                content
            };
        }
        
        function testContentExtraction() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = 'æ­£åœ¨æå–å†…å®¹...';
            
            setTimeout(() => {
                try {
                    const pageData = extractPageContent();
                    resultsDiv.innerHTML = `âœ… å†…å®¹æå–æˆåŠŸï¼

ğŸ“„ é¡µé¢æ ‡é¢˜: ${pageData.title}
ğŸ”— é¡µé¢URL: ${pageData.url}
ğŸ“ å†…å®¹é•¿åº¦: ${pageData.content.length} å­—ç¬¦

ğŸ“ å†…å®¹é¢„è§ˆ:
${pageData.content.substring(0, 500)}...

ğŸ“Š æå–ç»Ÿè®¡:
- æ˜¯å¦åŒ…å«å¯¼èˆªå†…å®¹: ${pageData.content.includes('é¦–é¡µ') || pageData.content.includes('å…³äº') ? 'âŒ æ˜¯' : 'âœ… å¦'}
- æ˜¯å¦åŒ…å«ä¾§è¾¹æ å†…å®¹: ${pageData.content.includes('ä¾§è¾¹æ ') ? 'âŒ æ˜¯' : 'âœ… å¦'}
- æ˜¯å¦åŒ…å«é¡µè„šå†…å®¹: ${pageData.content.includes('Â© 2024') ? 'âŒ æ˜¯' : 'âœ… å¦'}
- æ˜¯å¦åŒ…å«ä¸»è¦å†…å®¹: ${pageData.content.includes('äººå·¥æ™ºèƒ½åœ¨åŒ»ç–—é¢†åŸŸ') ? 'âœ… æ˜¯' : 'âŒ å¦'}
- æ˜¯å¦åŒ…å«æŠ€æœ¯ç»†èŠ‚: ${pageData.content.includes('æ·±åº¦å­¦ä¹ ç®—æ³•') ? 'âœ… æ˜¯' : 'âŒ å¦'}`;
                } catch (error) {
                    resultsDiv.innerHTML = `âŒ å†…å®¹æå–å¤±è´¥: ${error.message}`;
                }
            }, 100);
        }
        
        function showPageStructure() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'block';
            
            let structure = 'ğŸ“‹ é¡µé¢ç»“æ„åˆ†æ:\n\n';
            
            // åˆ†æé¡µé¢ç»“æ„
            const elements = document.querySelectorAll('div, section, article, main, header, footer, nav, aside');
            elements.forEach(element => {
                const tagName = element.tagName.toLowerCase();
                const className = element.className;
                const id = element.id;
                const textLength = element.textContent.trim().length;
                
                if (textLength > 50) { // åªæ˜¾ç¤ºæœ‰å†…å®¹çš„å…ƒç´ 
                    structure += `${tagName}${className ? '.' + className.split(' ')[0] : ''}${id ? '#' + id : ''} (${textLength}å­—ç¬¦)\n`;
                }
            });
            
            resultsDiv.innerHTML = structure;
        }
        
        function clearResults() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'none';
            resultsDiv.innerHTML = '';
        }
        
        // å¦‚æœè¢«æ‰©å±•è°ƒç”¨ï¼Œè¿”å›æå–çš„å†…å®¹
        if (window.chrome && window.chrome.runtime) {
            chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
                if (request.action === 'extractContent') {
                    sendResponse({
                        success: true,
                        data: extractPageContent()
                    });
                }
            });
        }
    </script>
</body>
</html>
