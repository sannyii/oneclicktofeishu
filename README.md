# 一键发送到飞书 Chrome插件

一个Chrome浏览器插件，可以一键将当前页面内容总结并发送到飞书群。

## 功能特点

- 🚀 一键操作：点击插件图标即可处理当前页面
- 🎯 悬浮按钮：页面右侧悬浮按钮，无需打开插件弹窗，支持自由拖动
- 🤖 AI总结：使用OpenAI或DeepSeek API智能总结页面内容，支持多种模型选择
- 📝 结构化输出：生成标题、要点、总结的格式
- 📝 纯文本输出：专注于文本内容总结，避免图片发送问题
- 💬 飞书集成：直接发送到飞书群
- ⚙️ 配置保存：自动保存API配置信息，支持分别保存OpenAI和DeepSeek的API Key
- 🎛️ 模型选择：支持GPT-5、GPT-5 Mini、GPT-5 Nano、GPT-4o Mini、GPT-4o
- 📝 自定义提示词：可自定义系统提示词来指导AI行为
- 🛡️ 内容过滤：自动过滤敏感内容，避免违反API使用政策
- 🔄 重试机制：网络错误时自动重试，提高成功率
- 🔔 实时通知：操作状态实时反馈，用户体验更佳

## 安装方法

### 1. 下载插件文件
将整个项目文件夹下载到本地。

### 2. 在Chrome中加载插件
1. 打开Chrome浏览器
2. 访问 `chrome://extensions/`
3. 开启右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择项目文件夹

### 3. 配置API密钥
1. 点击浏览器工具栏中的插件图标
2. 输入API Key（OpenAI或DeepSeek）
3. 输入飞书机器人Webhook URL
4. 选择AI模型（推荐GPT-4o Mini）
5. 可选：输入自定义系统提示词
6. 配置会自动保存

## 使用方法

### 方法一：使用悬浮按钮（推荐）
1. 打开任意网页
2. 在页面右侧找到蓝色的悬浮按钮
3. 点击悬浮按钮即可发送到飞书
4. 观察按钮状态变化和通知信息
5. **拖动功能**：按住鼠标左键可拖动按钮到任意位置

### 方法二：使用插件弹窗
1. 打开任意网页
2. 点击Chrome工具栏中的插件图标
3. 点击"发送到飞书"按钮
4. 等待处理完成

## 配置说明

### API Key
- 支持 [OpenAI](https://platform.openai.com/api-keys) 或 [DeepSeek](https://platform.deepseek.com/) 提供的API Key
- 需要有效的对应账户和余额
- OpenAI支持GPT-5、GPT-5 Mini、GPT-5 Nano、GPT-4o Mini、GPT-4o等模型
- **推荐**：GPT-5 Mini，兼顾质量与速度；也可根据需求选择 GPT-5（旗舰）或 GPT-5 Nano（更高性价比）
- 插件会分别保存不同服务商的API Key，切换时无需重新输入

### 飞书机器人配置
1. 在飞书中创建机器人
2. 获取Webhook URL
3. 将机器人添加到目标群组

## 输出格式

插件会生成以下格式的内容发送到飞书：

```
标题1：[氛围感标题一]
标题2：[氛围感标题二]

导读：[概括全文的导读段落]

要点：
1. [要点1]
2. [要点2]
3. [要点3]

链接：[页面URL]
```

## 文件结构

```
oneclicktofeishu/
├── manifest.json      # 插件配置文件
├── popup.html         # 弹出窗口界面
├── popup.js           # 弹出窗口逻辑
├── content.js         # 内容脚本（提取页面内容 + 悬浮按钮）
├── background.js      # 后台脚本（API调用）
├── icons/             # 插件图标
├── test_floating_button.html  # 悬浮按钮测试页面
├── drag_test.html             # 拖动功能测试页面
├── error_test.html            # 错误修复测试页面
└── README.md          # 说明文档
```

## 技术实现

- **Manifest V3**: 使用最新的Chrome扩展API
- **Content Script**: 提取页面内容 + 悬浮按钮UI
- **Background Script**: 处理API调用和消息发送
- **AI API**: 支持OpenAI和DeepSeek等多种模型进行内容总结
- **飞书API**: 使用Webhook发送消息
- **悬浮按钮**: 固定在页面右侧，提供便捷的一键操作

## 安全特性

- **内容过滤**: 自动检测并过滤敏感词汇，避免违反API使用政策
- **提示词验证**: 检查自定义系统提示词是否包含敏感指令
- **内容长度限制**: 自动截断过长内容，避免API调用失败
- **错误分类**: 智能识别不同类型的API错误，提供针对性解决方案
- **重试机制**: 网络错误时自动重试，提高成功率

## 注意事项

1. 确保API Key有效且有足够余额
2. 飞书机器人需要有发送消息的权限
3. 某些网站可能因为CSP策略无法正常提取内容

## 故障排除

### 常见问题

1. **"无法访问页面内容"**
   - 刷新页面后重试
   - 确保页面完全加载

2. **"AI API错误"**
   - 检查API Key是否正确
   - 确认账户余额充足
   - 检查模型是否可用
   - 如果GPT-5 系列或 DeepSeek Chat 不可用，会自动提供替代建议

3. **"内容违反API使用政策"**
   - 页面内容可能包含敏感词汇
   - 尝试不同的网页内容
   - 检查自定义提示词是否包含敏感指令

4. **"飞书API错误"**
   - 检查Webhook URL是否正确
   - 确认机器人权限设置

5. **"网络连接错误"**
   - 插件会自动重试3次
   - 检查网络连接是否稳定

6. **"模型不可用错误"**
   - GPT-5 系列可能需要特殊访问权限
   - 插件会自动验证模型可用性并提供替代建议
   - 如果当前模型不可用，会优先推荐 GPT-5 Mini 或 GPT-4o Mini

7. **悬浮按钮不显示**
   - 确保扩展已正确安装并启用
   - 刷新页面后重试
   - 检查页面是否有JavaScript错误
   - 某些网站可能因为安全策略阻止悬浮按钮显示

8. **悬浮按钮点击无响应**
   - 检查是否已配置API Key和飞书Webhook
   - 查看浏览器控制台是否有错误信息
   - 确保网络连接正常

9. **拖动功能不工作**
   - 确保按钮没有被禁用（灰色状态）
   - 尝试刷新页面后重新拖动
   - 检查是否有其他扩展干扰鼠标事件

## 开发说明

如需修改或扩展功能：

1. 修改 `content.js` 调整内容提取逻辑
2. 修改 `background.js` 调整API调用和消息格式
3. 修改 `popup.html` 和 `popup.js` 调整用户界面
4. 重新加载插件即可生效

## 许可证

MIT License
